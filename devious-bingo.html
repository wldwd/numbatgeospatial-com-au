<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Devious Frames Bingo</title>
    <link
      rel="stylesheet"
      href="https://cdn.staticdelivr.com/gfonts/css2?family=Fira+Code:wght@300..700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
    />
    <style>
      :root {
        --background: #1a170f;
        --foreground: #fefefe;
        --accent: #ff2600;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Fira Code", "JetBrains Mono", Monaco, Consolas, monospace;
        font-size: 1rem;
        line-height: 1.54em;
        background-color: var(--background);
        color: var(--foreground);
        min-height: 100vh;
        padding: 12px;
        text-rendering: optimizeLegibility;
        -webkit-text-size-adjust: 100%;
      }
      .container {
        max-width: 520px;
        margin: 0 auto;
      }
      h1 {
        font-family: "VT323", monospace;
        font-size: 2.4rem;
        text-align: center;
        margin-bottom: 4px;
        color: var(--foreground);
      }
      .subtitle {
        text-align: center;
        font-size: 0.9rem;
        color: var(--accent);
        font-weight: 300;
        margin-bottom: 16px;
      }
      .name-section {
        text-align: center;
        margin-bottom: 16px;
      }
      .name-section input {
        font-family: "Fira Code", monospace;
        font-size: 0.9rem;
        padding: 8px 14px;
        border: 2px solid color-mix(in srgb, var(--foreground) 25%, transparent);
        background: transparent;
        color: var(--foreground);
        text-align: center;
        width: 220px;
        transition: border-color 0.2s ease;
      }
      .name-section input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 15%, transparent);
      }
      .name-section input::placeholder {
        color: color-mix(in srgb, var(--foreground) 40%, transparent);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2px;
        margin-bottom: 14px;
        border: 3px solid var(--accent);
        overflow: hidden;
      }
      .cell {
        background: color-mix(in srgb, var(--foreground) 5%, transparent);
        padding: 8px 6px;
        aspect-ratio: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 0.65rem;
        line-height: 1.3;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.15s;
        border: 1px solid color-mix(in srgb, var(--foreground) 12%, transparent);
        -webkit-tap-highlight-color: transparent;
      }
      .cell-title {
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 4px;
      }
      .cell-def {
        font-size: 0.7rem;
        font-weight: 300;
        opacity: 0.6;
        line-height: 1.3;
      }
      .cell:hover {
        background: color-mix(in srgb, var(--accent) 10%, transparent);
      }
      .cell:active {
        opacity: 0.8;
      }
      .cell.checked {
        background: color-mix(in srgb, var(--accent) 25%, transparent);
        color: var(--foreground);
        border-color: var(--accent);
      }
      .cell.bingo-line {
        animation: glow 0.6s ease-in-out infinite alternate;
      }
      @keyframes glow {
        from {
          box-shadow: inset 0 0 8px var(--accent);
        }
        to {
          box-shadow: inset 0 0 20px var(--accent);
        }
      }

      .buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 14px;
      }
      .btn {
        font-family: "Fira Code", monospace;
        font-size: 0.8rem;
        font-weight: 600;
        padding: 6px 18px;
        border: 2px solid var(--accent);
        background: transparent;
        color: var(--accent);
        cursor: pointer;
        transition: background 0.15s linear;
        -webkit-tap-highlight-color: transparent;
      }
      .btn:hover {
        background: color-mix(in srgb, var(--accent) 15%, transparent);
      }
      .btn:active {
        background: var(--accent);
        color: var(--background);
      }

      .banner {
        text-align: center;
        font-family: "VT323", monospace;
        font-size: 1.6rem;
        padding: 12px;
        margin-bottom: 12px;
        background: var(--accent);
        color: var(--background);
        font-weight: 600;
        display: none;
      }
      .banner.show {
        display: block;
        animation: popIn 0.3s ease-out;
      }
      @keyframes popIn {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--accent);
        color: var(--background);
        padding: 10px 20px;
        font-family: "Fira Code", monospace;
        font-size: 0.8rem;
        font-weight: 600;
        display: none;
        z-index: 100;
      }
      .toast.show {
        display: block;
        animation: fadeInOut 2s ease-in-out forwards;
      }
      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translateX(-50%) translateY(10px);
        }
        15% {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
        85% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      .score {
        text-align: center;
        font-size: 0.8rem;
        color: color-mix(in srgb, var(--foreground) 60%, transparent);
        margin-bottom: 12px;
      }
      .footer {
        text-align: center;
        font-size: 0.75rem;
        color: color-mix(in srgb, var(--foreground) 35%, transparent);
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid
          color-mix(in srgb, var(--foreground) 20%, transparent);
      }

      @media (max-width: 400px) {
        h1 {
          font-size: 1.8rem;
        }
        .cell {
          min-height: 62px;
          font-size: 0.58rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Devious Frames Bingo</h1>
      <p class="subtitle">
        Tap when you read or hear one of the Nine Devious Frames
      </p>

      <div class="name-section">
        <input
          type="text"
          id="playerName"
          placeholder="Your name"
          maxlength="20"
        />
        <input
          type="text"
          id="shareNotes"
          placeholder="Notes (optional)"
          maxlength="100"
          style="margin-top: 8px"
        />
      </div>

      <div class="banner" id="banner">BINGO!</div>

      <div class="score" id="score">0 / 9</div>

      <div class="grid" id="grid"></div>

      <div class="buttons">
        <button class="btn" onclick="shareResult()">Share result</button>
        <button class="btn" onclick="newCard()">New card</button>
      </div>

      <p class="footer">
        Nine Devious Frames taken from
        <em
          >Dark PR: How Corporate Disinformation Undermines Our Health and the
          Environment</em
        >
        by Grant Ennis
      </p>
    </div>

    <div class="toast" id="toast">Copied to clipboard!</div>

    <script>
      const allSquares = [
        { name: "Denialism", def: "There is no problem" },
        { name: "Post-denialism", def: "What's bad is good" },
        { name: "Normalisation", def: "It's not a problem, it's normal" },
        {
          name: "Silver Boomerang",
          def: "Pseudo-solutions with hidden negatives",
        },
        { name: "Magic", def: "False dawns that never materialise" },
        { name: "Treatment", def: "Treat problems, don't prevent them" },
        { name: "Victim Blaming", def: "Blame victims, not the policies" },
        {
          name: "Knotted Web",
          def: "Everything is complex, no clear solution",
        },
        { name: "Multifactorial", def: "Combine frames that don't work alone" },
      ];

      let squares = [];
      let checked = Array(9).fill(false);
      let bingoLines = [];

      function shuffle(a) {
        const b = [...a];
        for (let i = b.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [b[i], b[j]] = [b[j], b[i]];
        }
        return b;
      }

      function generateCard() {
        squares = shuffle(allSquares);
      }

      const winLines = [];
      for (let r = 0; r < 3; r++)
        winLines.push([0, 1, 2].map((c) => r * 3 + c));
      for (let c = 0; c < 3; c++)
        winLines.push([0, 1, 2].map((r) => r * 3 + c));
      winLines.push([0, 4, 8]);
      winLines.push([2, 4, 6]);

      function checkBingo() {
        bingoLines = [];
        for (const line of winLines) {
          if (line.every((i) => checked[i])) bingoLines.push(line);
        }
        return bingoLines.length > 0;
      }

      function getScore() {
        return checked.filter(Boolean).length;
      }

      function render() {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";
        const bingoCells = new Set(bingoLines.flat());

        squares.forEach((sq, i) => {
          const cell = document.createElement("div");
          cell.className = "cell";
          if (checked[i]) cell.classList.add("checked");
          if (bingoCells.has(i)) cell.classList.add("bingo-line");
          const title = document.createElement("span");
          title.className = "cell-title";
          title.textContent = sq.name;
          const sub = document.createElement("span");
          sub.className = "cell-def";
          sub.textContent = sq.def;
          cell.appendChild(title);
          cell.appendChild(sub);
          cell.onclick = () => toggle(i);
          grid.appendChild(cell);
        });

        const pts = getScore();
        document.getElementById("score").textContent = pts + " / 9";

        const banner = document.getElementById("banner");
        if (bingoLines.length > 0) {
          banner.className = "banner show";
          banner.textContent =
            bingoLines.length > 1 ? "BINGO! Multiple lines." : "BINGO!";
        } else {
          banner.className = "banner";
        }
      }

      function toggle(i) {
        checked[i] = !checked[i];
        checkBingo();
        render();
      }

      function newCard() {
        generateCard();
        checked = Array(9).fill(false);
        bingoLines = [];
        render();
      }

      function shareResult() {
        const name =
          document.getElementById("playerName").value.trim() || "Anonymous";
        const hasBingo = bingoLines.length > 0;
        const pts = getScore();

        let grid = "";
        for (let r = 0; r < 3; r++) {
          let row = "";
          for (let c = 0; c < 3; c++) {
            const i = r * 3 + c;
            row += checked[i] ? "ðŸŸ¥" : "â¬œ";
          }
          grid += row + "\n";
        }

        let text = "Devious Frames Bingo\n";
        text += name + " â€” " + pts + " / 9\n";
        text += grid;
        if (hasBingo) {
          text += bingoLines.length > 1 ? "BINGO! Multiple lines." : "BINGO!";
        } else {
          text += "No bingo yet";
        }
        const notes = document.getElementById("shareNotes").value.trim();
        if (notes) text += "\n\n" + notes;
        text += "\n\nPlay: numbatgeospatial.com.au/devious-bingo";

        if (navigator.clipboard) {
          navigator.clipboard.writeText(text).then(() => showToast());
        }
      }

      function showToast() {
        const t = document.getElementById("toast");
        t.className = "toast";
        void t.offsetWidth;
        t.className = "toast show";
        setTimeout(() => (t.className = "toast"), 2000);
      }

      newCard();
    </script>
  </body>
</html>
